<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Settings - EHAMBURG DAILY</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="webfavehd.jpg">
    
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Website Notice Banner -->
    <div class="notice-banner" id="website-notice" style="display: none;">
        <div class="notice-content">
            <div class="notice-icon">
                <i>!</i>
            </div>
            <span class="notice-text">Loading...</span>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="dark ehd logo.png" alt="EHAMBURG DAILY" class="main-logo">
            </div>
            <nav class="nav-desktop">
                <div class="nav-section">
                    <button class="nav-section-title">News</button>
                    <div class="nav-dropdown">
                        <a href="index.html" class="nav-section-item">Home</a>
                        <a href="index.html#game-update" class="nav-section-item">Game Updates</a>
                    </div>
                </div>
                <div class="nav-section">
                    <button class="nav-section-title">About Us</button>
                    <div class="nav-dropdown">
                        <a href="about.html" class="nav-section-item">About</a>
                        <a href="settings.html" class="nav-section-item">Settings</a>
                    </div>
                </div>
                <div class="nav-section nav-emergency">
                    <button class="nav-section-title">Emergency Hamburg</button>
                    <div class="nav-dropdown">
                        <a href="emergency-hamburg.html" class="nav-section-item">About Game</a>
                        <a href="credits.html" class="nav-section-item">Credits</a>
                    </div>
                </div>
                <div class="nav-section">
                    <button class="nav-section-title">Follow Us</button>
                    <div class="nav-dropdown">
                        <div class="social-links">
                            <a href="https://x.com/ehamburg82588?s=21" target="_blank" class="social-link">
                                <img src="x logo.png" alt="X (Twitter)">
                            </a>
                            <a href="https://www.tiktok.com/@ehamburgdaily" target="_blank" class="social-link">
                                <img src="tiktok logo.png" alt="TikTok">
                            </a>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- Desktop Login Button Removed - Authentication now handled in main content -->
            
            <!-- Desktop User Profile -->
            <div class="auth-user-profile auth-user-profile-desktop" style="display: none;">
                <div class="auth-user-info">
                    <img class="auth-user-avatar" src="" alt="User Avatar">
                    <div class="auth-user-details">
                        <div class="auth-user-name">User</div>
                        <div class="auth-user-email">user@example.com</div>
                    </div>
                </div>
                <div class="auth-user-dropdown">
                    <div class="auth-dropdown-content">
                        <div class="auth-dropdown-header">
                            <img class="auth-user-avatar" src="" alt="User Avatar">
                            <div>
                                <div class="auth-user-name">User</div>
                                <div class="auth-user-email">user@example.com</div>
                            </div>
                        </div>
                        <div class="auth-dropdown-divider"></div>
                        <button class="auth-dropdown-item" onclick="window.location.href='settings.html'">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="m19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                            Settings
                        </button>
                        <button class="auth-dropdown-item" onclick="authSystem.signOutUser()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16,17 21,12 16,7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-input-wrapper">
                    <div class="search-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21L16.5 16.5"></path>
                        </svg>
                    </div>
                    <input type="text" id="search-input" placeholder="Search news, updates, developers..." class="search-input">
                    <div class="search-clear" id="search-clear" style="display: none;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </div>
                </div>
                <div id="search-results" class="search-results">
                    <div class="search-suggestions" id="search-suggestions" style="display: none;">
                        <div class="search-category">
                            <div class="search-category-title">Popular Searches</div>
                            <div class="search-suggestion-item" data-search="news">Latest News</div>
                            <div class="search-suggestion-item" data-search="game update">Game Updates</div>
                            <div class="search-suggestion-item" data-search="developers">Team Members</div>
                            <div class="search-suggestion-item" data-search="emergency hamburg">Emergency Hamburg</div>
                        </div>
                    </div>
                    <div id="search-results-content"></div>
                </div>
            </div>
            
            <button class="hamburger-menu" id="hamburger-menu">
                <img src="menuicon.png" alt="Menu" class="menu-icon">
            </button>
            <!-- Mobile Navigation Menu -->
            <div class="nav-mobile" id="nav-mobile">
                <!-- Mobile Authentication -->
                <div class="auth-login-btn auth-login-btn-mobile" onclick="authSystem.showLoginModal()">
                    <div class="auth-mobile-login-content">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span>Sign In</span>
                    </div>
                </div>
                
                <div class="auth-user-profile auth-user-profile-mobile" style="display: none;">
                    <div class="auth-mobile-profile-header">
                        <img class="auth-user-avatar" src="" alt="User Avatar">
                        <div class="auth-mobile-profile-info">
                            <div class="auth-user-name">User</div>
                            <div class="auth-user-email">user@example.com</div>
                        </div>
                    </div>
                    <div class="auth-mobile-profile-actions">
                        <button class="auth-mobile-action" onclick="window.location.href='settings.html'">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="m19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                            Settings
                        </button>
                        <button class="auth-mobile-action" onclick="authSystem.signOutUser()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16,17 21,12 16,7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Sign Out
                        </button>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">News</div>
                    <a href="index.html" class="nav-section-item">Home</a>
                    <a href="index.html#game-update" class="nav-section-item">Game Updates</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">About Us</div>
                    <a href="about.html" class="nav-section-item">About</a>
                    <a href="settings.html" class="nav-section-item">Settings</a>
                </div>
                <div class="nav-section nav-emergency-mobile">
                    <div class="nav-section-title">Emergency Hamburg</div>
                    <a href="emergency-hamburg.html" class="nav-section-item">About Game</a>
                    <a href="credits.html" class="nav-section-item">Credits</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Follow Us</div>
                    <div class="social-links">
                        <a href="https://x.com/ehamburg82588?s=21" target="_blank" class="social-link">
                            <img src="x logo.png" alt="X (Twitter)">
                        </a>
                        <a href="https://www.tiktok.com/@ehamburgdaily" target="_blank" class="social-link">
                            <img src="tiktok logo.png" alt="TikTok">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobile-overlay"></div>
    
    <!-- Login Modal -->
    <div id="auth-modal" class="auth-modal" style="display: none;">
        <div class="auth-modal-overlay" onclick="authSystem.hideLoginModal()"></div>
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <h2 class="auth-modal-title">Sign in to EHAMBURG DAILY</h2>
                <button class="auth-modal-close" onclick="authSystem.hideLoginModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="auth-modal-body">
                <!-- Loading State -->
                <div class="auth-loading" style="display: none;">
                    <div class="auth-loading-spinner"></div>
                    <div class="auth-loading-message">Loading...</div>
                </div>
                
                <!-- Login Tabs -->
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="signin">Sign In</button>
                    <button class="auth-tab" data-tab="signup">Sign Up</button>
                </div>
                
                <!-- Sign In Form -->
                <div class="auth-form" id="signin-form">
                    <!-- Google Sign In -->
                    <button class="auth-google-btn" onclick="authSystem.signInWithGoogle()">
                        <div class="auth-google-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                        </div>
                        Continue with Google
                    </button>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <!-- Email Form -->
                    <form class="auth-email-form" id="signin-email-form">
                        <div class="auth-form-group">
                            <label for="signin-email">Email</label>
                            <input type="email" id="signin-email" name="email" required>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="signin-password">Password</label>
                            <input type="password" id="signin-password" name="password" required>
                        </div>
                        
                        <button type="submit" class="auth-submit-btn">Sign In</button>
                    </form>
                </div>
                
                <!-- Sign Up Form -->
                <div class="auth-form" id="signup-form" style="display: none;">
                    <!-- Google Sign Up -->
                    <button class="auth-google-btn" onclick="authSystem.signInWithGoogle()">
                        <div class="auth-google-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                        </div>
                        Continue with Google
                    </button>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <!-- Email Signup Form -->
                    <form class="auth-email-form" id="signup-email-form">
                        <div class="auth-form-group">
                            <label for="signup-name">Full Name</label>
                            <input type="text" id="signup-name" name="name" required>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="signup-email">Email</label>
                            <input type="email" id="signup-email" name="email" required>
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" name="password" required minlength="6">
                        </div>
                        
                        <div class="auth-form-group">
                            <label for="signup-confirm-password">Confirm Password</label>
                            <input type="password" id="signup-confirm-password" name="confirmPassword" required minlength="6">
                        </div>
                        
                        <button type="submit" class="auth-submit-btn">Create Account</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Container -->
    <div id="message-container" class="message-container"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Authentication Section -->
            <section class="settings-section">
                <div class="section-indicator">
                    <div class="blue-line"></div>
                    <span class="section-text">Account & Authentication</span>
                </div>
                
                <div class="settings-container">
                    <!-- User Status Display -->
                    <div class="auth-status-card" id="auth-status-card">
                        <!-- Signed Out State -->
                        <div class="auth-signed-out" id="auth-signed-out">
                            <div class="auth-status-header">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <h3>Sign in to your account</h3>
                                <p>Access your personalized settings and preferences</p>
                            </div>
                            <div class="auth-actions">
                                <button class="auth-primary-btn" onclick="authSystem.showLoginModal()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    Sign In / Sign Up
                                </button>
                            </div>
                        </div>
                        
                        <!-- Signed In State -->
                        <div class="auth-signed-in" id="auth-signed-in" style="display: none;">
                            <div class="auth-profile-header">
                                <img class="auth-profile-avatar" src="" alt="Profile Avatar" id="profile-avatar">
                                <div class="auth-profile-info">
                                    <h3 class="auth-profile-name" id="profile-name">User Name</h3>
                                    <p class="auth-profile-email" id="profile-email">user@example.com</p>
                                    <span class="auth-profile-status">Signed in successfully</span>
                                </div>
                            </div>
                            <div class="auth-profile-actions">
                                <button class="auth-secondary-btn" onclick="authSystem.signOutUser()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                        <polyline points="16,17 21,12 16,7"></polyline>
                                        <line x1="21" y1="12" x2="9" y2="12"></line>
                                    </svg>
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="settings-section">
                <div class="section-indicator">
                    <div class="blue-line"></div>
                    <span class="section-text">Notice Banner Settings</span>
                </div>
                
                <div class="settings-container">
                    <div class="settings-form">
                        <div class="form-group">
                            <label for="notice-enabled">Enable Notice Banner</label>
                            <input type="checkbox" id="notice-enabled" class="checkbox-input">
                            <span class="checkbox-label">Show the notice banner at the top of the website</span>
                        </div>
                        
                        <div class="form-actions">
                            <button id="save-settings" class="save-btn">Save Settings</button>
                            <button id="test-banner" class="test-btn">Test Banner</button>
                        </div>
                        
                        <div class="settings-status">
                            <div class="status-item">
                                <span class="status-label">Banner Status:</span>
                                <span class="status-value" id="banner-status">Loading...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Last Updated:</span>
                                <span class="status-value" id="last-updated">-</span>
                            </div>
                        </div>
                        
                        <div class="quick-actions">
                            <h3>Quick Actions</h3>
                            <div class="action-buttons">
                                <button id="refresh-banner" class="action-btn">Refresh Banner</button>
                                <button id="clear-cache" class="action-btn">Clear Cache</button>
                                <button id="view-logs" class="action-btn">View Logs</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 EHAMBURG DAILY. All rights reserved.</p>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, getDocs, addDoc, updateDoc, doc, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD7I9K8ds6Px60jMm71Kt7weVAX-vhcM8w",
            authDomain: "ehamburg-90958.firebaseapp.com",
            projectId: "ehamburg-90958",
            storageBucket: "ehamburg-90958.firebasestorage.app",
            messagingSenderId: "166375320407",
            appId: "1:166375320407:web:1e3b0b85a410522bf4ec12",
            measurementId: "G-FLLYGR93PX"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // Make Firebase available globally
        window.auth = auth;
        window.googleProvider = googleProvider;
        window.db = db;
        window.getDocs = getDocs;
        window.collection = collection;
        window.addDoc = addDoc;
        window.updateDoc = updateDoc;
        window.doc = doc;
        window.query = query;
        window.orderBy = orderBy;
        window.limit = limit;

        // Load current settings
        async function loadSettings() {
            try {
                const noticeRef = collection(db, 'notice');
                const noticeSnapshot = await getDocs(noticeRef);
                
                if (!noticeSnapshot.empty) {
                    const settings = noticeSnapshot.docs[0].data();
                    document.getElementById('notice-enabled').checked = settings.enabled || false;
                    
                    // Update status display
                    updateStatusDisplay(settings);
                } else {
                    updateStatusDisplay({ enabled: false, lastUpdated: null });
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                updateStatusDisplay({ enabled: false, lastUpdated: null, error: true });
            }
        }

        // Update status display
        function updateStatusDisplay(settings) {
            const bannerStatus = document.getElementById('banner-status');
            const lastUpdated = document.getElementById('last-updated');
            
            if (settings.error) {
                bannerStatus.textContent = 'Error';
                bannerStatus.style.color = '#dc3545';
                lastUpdated.textContent = 'Failed to load';
            } else if (settings.enabled) {
                bannerStatus.textContent = 'Enabled';
                bannerStatus.style.color = '#28a745';
            } else {
                bannerStatus.textContent = 'Disabled';
                bannerStatus.style.color = '#6c757d';
            }
            
            if (settings.lastUpdated) {
                const date = new Date(settings.lastUpdated);
                lastUpdated.textContent = date.toLocaleString();
            } else {
                lastUpdated.textContent = 'Never';
            }
        }

        // Show message toast
        function showMessage(type, message, duration = 5000) {
            const container = document.getElementById('message-container');
            const messageId = 'msg-' + Date.now();
            
            const toast = document.createElement('div');
            toast.id = messageId;
            toast.className = `message-toast ${type}`;
            
            let iconSvg = '';
            if (type === 'success') {
                iconSvg = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"></polyline></svg>';
            } else if (type === 'error') {
                iconSvg = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
            } else {
                iconSvg = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>';
            }
            
            toast.innerHTML = `
                <div class="message-icon">${iconSvg}</div>
                <div class="message-text">${message}</div>
                <button class="message-close" onclick="removeMessage('${messageId}')">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after duration
            setTimeout(() => {
                removeMessage(messageId);
            }, duration);
        }

        // Remove message toast
        function removeMessage(messageId) {
            const message = document.getElementById(messageId);
            if (message) {
                message.classList.add('removing');
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }
        }

        // Save settings
        async function saveSettings() {
            try {
                const enabled = document.getElementById('notice-enabled').checked;
                
                const noticeRef = collection(db, 'notice');
                const noticeSnapshot = await getDocs(noticeRef);
                
                if (!noticeSnapshot.empty) {
                    // Update existing document - only update enabled field
                    const docId = noticeSnapshot.docs[0].id;
                    const existingData = noticeSnapshot.docs[0].data();
                    
                    const settings = {
                        ...existingData, // Keep existing text and other fields
                        enabled: enabled,
                        lastUpdated: new Date()
                    };
                    
                    await updateDoc(doc(db, 'notice', docId), settings);
                } else {
                    // Create new document with default text
                    const settings = {
                        enabled: enabled,
                        text: "Welcome to EHAMBURG DAILY!",
                        lastUpdated: new Date()
                    };
                    await addDoc(noticeRef, settings);
                }
                
                showMessage('success', 'Notice banner settings saved successfully!');
                console.log('Settings saved:', { enabled: enabled });
                
                // Update status display
                updateStatusDisplay({ enabled: enabled, lastUpdated: new Date() });
                
                // Automatically update notice banner on all pages
                updateNoticeBannerOnAllPages(enabled);
            } catch (error) {
                console.error('Error saving settings:', error);
                showMessage('error', 'Error saving settings. Please try again.');
            }
        }

        // Update notice banner on all pages
        function updateNoticeBannerOnAllPages(enabled) {
            console.log('Updating notice banner on all pages, enabled:', enabled);
            
            // Update current page if it has notice banner
            const banner = document.getElementById('website-notice');
            if (banner) {
                if (enabled) {
                    banner.style.display = 'block';
                    // Add class to header and main content to adjust positioning
                    document.querySelector('.header').classList.add('with-notice');
                    document.querySelector('.main-content').classList.add('with-notice');
                    
                    // Load content from Firebase when enabled
                    if (typeof loadNoticeBanner === 'function') {
                        loadNoticeBanner();
                    }
                    console.log('Notice banner enabled on current page');
                } else {
                    banner.style.display = 'none';
                    // Remove class from header and main content
                    document.querySelector('.header').classList.remove('with-notice');
                    document.querySelector('.main-content').classList.remove('with-notice');
                    console.log('Notice banner disabled on current page');
                }
            }
            
            // Trigger refresh on other pages via localStorage
            localStorage.setItem('noticeBannerUpdate', JSON.stringify({
                enabled: enabled,
                timestamp: Date.now()
            }));
            
            // Dispatch custom event for other pages
            window.dispatchEvent(new CustomEvent('noticeBannerUpdate', {
                detail: { enabled: enabled }
            }));
        }

        // Test banner
        function testBanner() {
            const enabled = document.getElementById('notice-enabled').checked;
            if (enabled) {
                showMessage('info', 'Notice banner is enabled! Check your website to see the banner.');
            } else {
                showMessage('info', 'Notice banner is disabled. Enable it first to test.');
            }
        }

        // Refresh banner
        function refreshBanner() {
            loadSettings();
            showMessage('info', 'Banner settings refreshed!');
        }

        // Clear cache
        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            showMessage('info', 'Cache cleared! Please refresh the page.');
        }

        // View logs
        function viewLogs() {
            const logs = [
                'Banner Status: ' + document.getElementById('banner-status').textContent,
                'Last Updated: ' + document.getElementById('last-updated').textContent,
                'Current Time: ' + new Date().toLocaleString(),
                'User Agent: ' + navigator.userAgent
            ];
            showMessage('info', 'System Logs: ' + logs.join(' | '));
        }

        // Event listeners
        document.getElementById('save-settings').addEventListener('click', saveSettings);
        document.getElementById('test-banner').addEventListener('click', testBanner);
        document.getElementById('refresh-banner').addEventListener('click', refreshBanner);
        document.getElementById('clear-cache').addEventListener('click', clearCache);
        document.getElementById('view-logs').addEventListener('click', viewLogs);

        // Load settings when page loads
        document.addEventListener('DOMContentLoaded', loadSettings);
        
        // Initialize auth UI for settings page
        function initializeSettingsAuthUI() {
            const signedOutEl = document.getElementById('auth-signed-out');
            const signedInEl = document.getElementById('auth-signed-in');
            
            // Check if user is already signed in
            if (window.authSystem && window.authSystem.getCurrentUser()) {
                const user = window.authSystem.getCurrentUser();
                showSignedInState(user);
            } else {
                showSignedOutState();
            }
        }
        
        // Show signed out state
        function showSignedOutState() {
            const signedOutEl = document.getElementById('auth-signed-out');
            const signedInEl = document.getElementById('auth-signed-in');
            
            if (signedOutEl) signedOutEl.style.display = 'block';
            if (signedInEl) signedInEl.style.display = 'none';
        }
        
        // Show signed in state
        function showSignedInState(user) {
            const signedOutEl = document.getElementById('auth-signed-out');
            const signedInEl = document.getElementById('auth-signed-in');
            const profileName = document.getElementById('profile-name');
            const profileEmail = document.getElementById('profile-email');
            const profileAvatar = document.getElementById('profile-avatar');
            
            if (signedOutEl) signedOutEl.style.display = 'none';
            if (signedInEl) signedInEl.style.display = 'block';
            
            if (user) {
                const displayName = user.displayName || user.email.split('@')[0];
                const photoURL = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=007bff&color=fff`;
                
                if (profileName) profileName.textContent = displayName;
                if (profileEmail) profileEmail.textContent = user.email;
                if (profileAvatar) profileAvatar.src = photoURL;
            }
        }
        
        // Listen for auth state changes
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize immediately
            initializeSettingsAuthUI();
            
            // Listen for auth state changes via custom events or periodic checks
            const checkAuthState = () => {
                if (window.authSystem && window.authSystem.getCurrentUser()) {
                    showSignedInState(window.authSystem.getCurrentUser());
                } else {
                    showSignedOutState();
                }
            };
            
            // Check auth state periodically
            setInterval(checkAuthState, 1000);
        });
    </script>

    <script src="script.js"></script>
    <script src="firebase-notice.js"></script>
    <script src="mobile-nav.js"></script>
    <script src="search.js"></script>
    <script src="auth.js"></script>
    
    <script>
    // Authentication form handling
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching
        const tabs = document.querySelectorAll('.auth-tab');
        const forms = document.querySelectorAll('.auth-form');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Show/hide forms
                forms.forEach(form => {
                    if (form.id === targetTab + '-form') {
                        form.style.display = 'block';
                    } else {
                        form.style.display = 'none';
                    }
                });
            });
        });
        
        // Sign in form submission
        const signinForm = document.getElementById('signin-email-form');
        if (signinForm) {
            signinForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('signin-email').value;
                const password = document.getElementById('signin-password').value;
                authSystem.signInWithEmail(email, password);
            });
        }
        
        // Sign up form submission
        const signupForm = document.getElementById('signup-email-form');
        if (signupForm) {
            signupForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;
                
                if (password !== confirmPassword) {
                    authSystem.showMessage('error', 'Passwords do not match');
                    return;
                }
                
                authSystem.signUpWithEmail(email, password, name);
            });
        }
        
        // User profile dropdown toggle
        const userProfiles = document.querySelectorAll('.auth-user-profile-desktop');
        userProfiles.forEach(profile => {
            profile.addEventListener('click', function(e) {
                e.stopPropagation();
                this.classList.toggle('active');
            });
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            userProfiles.forEach(profile => {
                profile.classList.remove('active');
            });
        });
    });
    </script>
</body>
</html>
